<!DOCTYPE html>
<html lang="en">
<head>
<script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>
<script id="shade_vert" type="x-shader/x-vertex">
attribute vec3 vPosition,vNormal;
varying vec4 C;
uniform float X;
varying vec3 fragmentNormal;
mat4 projection = mat4(1.30,0,0,0,0,1.73,0,0,0,0,-1,-1,0,0,-.2,0);
uniform float time;

vec3 lightPosition = vec3(0,0,5);
varying vec3 lightVector;

mat4 T(mat4 R) {
  return mat4(
      R[0][0],R[1][0],R[2][0],R[3][0],
      R[0][1],R[1][1],R[2][1],R[3][1],
      R[0][2],R[1][2],R[2][2],R[3][2],
      R[0][3],R[1][3],R[2][3],R[3][3]
  );
}
mat3 T(mat3 R) {
  return mat3(
      R[0][0],R[1][0],R[2][0],
      R[0][1],R[1][1],R[2][1],
      R[0][2],R[1][2],R[2][2]
      );
}
mat4 I(mat3 R, vec3 t)
{
  mat3 Rt = T(R);
  vec3 th = Rt*t;
  return mat4(
      R[0][0], R[1][0], R[2][0], 0,
      R[0][1], R[1][1], R[2][1], 0,
      R[0][2], R[1][2], R[2][2], 0,
      -th[0],  -th[1],  -th[2],  1
);
}

mat4 translate(vec3 pos) {
  mat4 m = mat4(1.0);
  m[3][0] = pos[0];
  m[3][1] = pos[1];
  m[3][2] = pos[2];
  return m;
}

mat3 rx(float t) {
  return mat3(
  1,      0,       0,
  0, cos(t), -sin(t),
  0, sin(t),  cos(t)
  );
}

mat4 view(mat3 R, vec3 P) {
  mat4 pos = mat4(1);
  pos[3][0] = P.x;
  pos[3][1] = P.y;
  pos[3][2] = P.z;
  return pos * mat4(
      R[0][0], R[0][1], R[0][2], 0,
      R[1][0], R[1][1], R[1][2], 0,
      R[2][0], R[2][1], R[2][2], 0,
      0, 0, 0, 1
  );
}

void main() {
  vec3 pos = vec3(0,0,-1.9);
  mat3 rot = rx(sin(time)*2.0);

  mat4 vTransform = projection * view(rot, pos);
  mat4 nTransform = projection * view(rot, pos);
  gl_Position    = (vTransform * vec4(vPosition, 1));
  fragmentNormal = (vTransform * vec4(vNormal,   1)).xyz;
  lightVector = lightPosition - vPosition;
  C = vec4(1,0,0,1);
}
</script>
<script id="shade_frag" type="x-shader/x-fragment">
precision mediump float;
varying vec4 C;
uniform float time;
uniform vec2 res;
varying vec3 fragmentNormal;
varying vec3 lightVector;
float MAX_DIST = 7.5;
float MAX_DIST_SQ = MAX_DIST * MAX_DIST;

void main(void){
  vec3 lightColor  = vec3(1,1,1);

  vec3 normal = normalize(fragmentNormal);

  float dist = min(dot(lightVector, lightVector), MAX_DIST_SQ) / MAX_DIST_SQ;
  float distFactor = 1.0 - dist;

  vec3 lightDir = normalize(lightVector);
  float diffuseDot = dot(normal, lightDir);
  vec3 diffuse = lightColor * clamp(diffuseDot, 0.0, 1.0) * distFactor;
  gl_FragColor = vec4(clamp((diffuse), 0.0, 1.0), 1);
}</script>
<script src="js/main.js"></script>
<!--<script src="dist/Cube.min.js"></script>-->
</head><body onload="start()"><canvas id="c" width="640" height="480"></canvas></body></html>
